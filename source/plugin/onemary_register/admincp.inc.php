<?php/*========================================================== *	Plugin Name   ï¼šonemary_job *	Plugin author : RaoLibao *	Updated date  : 2013-12-3 *	Phone number  : (086)18650336706, (0591)83701411 *	Other contact : QQ1609883787, Email 1609883787@qq.com *	AUTHOR URL    : http://www.onemary.com *	This is NOT a freeware, use is subject to license terms=============================================================*/ if(!defined('IN_DISCUZ') || !defined('IN_ADMINCP')) {	exit('Access Denied');}if(submitcheck('submit')){	require_once 'source/plugin/onemary_register/upload.class.php';	$upload = new onemary_job_upload();	if(!empty($_FILES['bgimg'])){		$upload->init($_FILES['bgimg']);		$upload->save();		$date['bgimg'] = $upload->attach['attachment'];		if(empty($date['bgimg'])){			unset($date['bgimg']);		}	}	if(!empty($_FILES['bannerimg'])){		$upload->init($_FILES['bannerimg']);		$upload->save();		$date['bannerimg'] = $upload->attach['attachment'];		if(empty($date['bannerimg'])){			unset($date['bannerimg']);		}	}	$date['val'] = serialize($_GET['date']);	$date['open'] = intval($_GET['open']);	$date['new_groupid'] = intval($_GET['new_groupid']);	$date['regverify'] = intval($_GET['regverify']);	$date['title'] = trim($_GET['title']);	$date['bannertitle'] = trim($_GET['bannertitle']);	$date['bannerurl'] = trim($_GET['bannerurl']);	$date['gallery_name']=trim($_GET['gallery_name']);	$gallery = $_GET['gallery'];	C::t('#onemary_register#onemary_register_field')->update($gallery,$date);	cpmsg(lang('plugin/onemary_register', 'ok'), 'action=plugins&identifier=onemary_register&pmod=admincp&mods=fieldid&gallery='.$gallery, 'succeed');} else {	include libfile('spacecp/profilevalidate', 'include');	echo '<style>.nva{margin-right: 5px;background: #09C;display: block;float: left;padding: 8px;color: white;}.hovers{background:#F2F9FD; color:#000;}.prompt{width:100%;}.center</style>';	$hover = !empty($_GET['gallery']) ? $_GET['gallery'] : 1;	$hover1 = ($hover == 1) ? ' hovers' : '';	$hover2 = ($hover == 2) ? ' hovers' : '';	$hover3 = ($hover == 3) ? ' hovers' : '';	$hover4 = ($hover == 4) ? ' hovers' : '';	$hover5 = ($hover == 5) ? ' hovers' : '';    $hover6 = ($hover == 6) ? ' hovers' : '';    $hover7 = ($hover == 7) ? ' hovers' : '';    $hover8 = ($hover == 8) ? ' hovers' : '';	$group_arr = C::t('#onemary_register#common_usergroup')->usergroup();	$profiles = C::t('common_member_profile_setting')->range();	$gallerys = C::t('#onemary_register#onemary_register_field')->fetch($hover);	$gallerys['val'] = (array)dunserialize($gallerys['val']);	echo "	<a href='admin.php?action=plugins&identifier=onemary_register&pmod=admincp&mods=fieldid&gallery=1' class='nva".$hover1."'>".lang('plugin/onemary_register', 'fieldidsetting1')."</a>	<a href='admin.php?action=plugins&identifier=onemary_register&pmod=admincp&mods=fieldid&gallery=2' class='nva".$hover2."'>".lang('plugin/onemary_register', 'fieldidsetting2')."</a>	<a href='admin.php?action=plugins&identifier=onemary_register&pmod=admincp&mods=fieldid&gallery=3' class='nva".$hover3."'>".lang('plugin/onemary_register', 'fieldidsetting3')."</a>	<a href='admin.php?action=plugins&identifier=onemary_register&pmod=admincp&mods=fieldid&gallery=4' class='nva".$hover4."'>".lang('plugin/onemary_register', 'fieldidsetting4')."</a>	<a href='admin.php?action=plugins&identifier=onemary_register&pmod=admincp&mods=fieldid&gallery=5' class='nva".$hover5."'>".lang('plugin/onemary_register', 'fieldidsetting5')."</a>	<a href='admin.php?action=plugins&identifier=onemary_register&pmod=admincp&mods=fieldid&gallery=6' class='nva".$hover6."'>".lang('plugin/onemary_register', 'fieldidsetting6')."</a>	<a href='admin.php?action=plugins&identifier=onemary_register&pmod=admincp&mods=fieldid&gallery=7' class='nva".$hover7."'>".lang('plugin/onemary_register', 'fieldidsetting7')."</a>	<a href='admin.php?action=plugins&identifier=onemary_register&pmod=admincp&mods=fieldid&gallery=8' class='nva".$hover8."'>".lang('plugin/onemary_register', 'fieldidsetting8')."</a>";	showformheader('plugins&identifier=onemary_register&pmod=admincp&mods=fieldid&gallery='.$hover,'enctype');	showtableheader(lang('plugin/onemary_register', 'fieldidsetting'.$hover).' => '.lang('plugin/onemary_register', 'setting'));	showsetting(lang('plugin/onemary_register', 'isopen'), 'open', $gallerys['open'], 'radio');	foreach($group_arr as $k => $v){		$groupselect[$k][] = $v['groupid']; 		$groupselect[$k][] = $v['grouptitle']; 	}	showsetting(lang('plugin/onemary_register', 'new_groupid'), array('new_groupid', $groupselect), ($gallerys['new_groupid'] ? $gallerys['new_groupid'] : 10), 'select');	showsetting(lang('plugin/onemary_register', 'regverify'), array('regverify',array(array(0,lang('plugin/onemary_register', 'regverify0')),array(1,lang('plugin/onemary_register', 'regverify1')),array(2,lang('plugin/onemary_register', 'regverify2')))),$gallerys['regverify'], 'mradio');	showsetting(lang('plugin/onemary_register', 'fieldidsetting'.$hover).lang('plugin/onemary_register', 'title').'('.lang('plugin/onemary_register', 'ishtml').')', 'title', $gallerys['title'], 'textarea');	showsetting(lang('plugin/onemary_register', 'bannerimg'), 'bannerimg', '', 'file');	showsetting(lang('plugin/onemary_register', 'bannerurl'), 'bannerurl', $gallerys['bannerurl'], 'text');	showsetting(lang('plugin/onemary_register', 'bannertitle'), 'bannertitle', $gallerys['bannertitle'], 'text');	showsetting(lang('plugin/onemary_register', 'bgimg'), 'bgimg', $gallerys['bgimg'], 'file');	showsetting(lang('plugin/onemary_register', 'gallery_name'), 'gallery_name', $gallerys['gallery_name'], 'text'); showtablefooter(); showtableheader(lang('plugin/onemary_register', 'fieldidsetting'.$hover).' => '.lang('plugin/onemary_register', 'fieldidsetting'));	showtagheader('tbody', '', true);							showsubtitle(array(lang('plugin/onemary_register', 'fieldid'), lang('plugin/onemary_register', 'open'), lang('plugin/onemary_register', 'compel'),lang('plugin/onemary_register', 'prompt'),lang('plugin/onemary_register', 'regular'),lang('plugin/onemary_register', 'fieldidedit')),'header',array('class=td22','class=td28','class=td28','class=td28','','class=center'));	foreach($profiles as $v){		if(!in_array($v['fieldid'],array('birthyear','birthmonth','birthprovince','birthdist','birthcommunity','resideprovince','residedist','residecommunity','constellation','zodiac'))){			showtablerow('', array('', '','','','','class="center"'), array($v['title'],			'<input type="hidden" name="gallery" value="'.$hover.'"><input type="checkbox" class="checkbox" name="date['.$v['fieldid'].'][open]" value="1"'.($gallerys['val'][$v['fieldid']]['open'] ? ' checked' : '').' />',			'<input type="checkbox" class="checkbox" name="date['.$v['fieldid'].'][compel]" value="1"'.($gallerys['val'][$v['fieldid']]['compel'] ? ' checked' : '').' />',			'<input type="text" class="prompt" name="date['.$v['fieldid'].'][prompt]" value="'.$gallerys['val'][$v['fieldid']]['prompt'].'"/>',			'<input type="text" class="prompt" name="date['.$v['fieldid'].'][preg]" value="'.($gallerys['val'][$v['fieldid']]['preg'] ? $gallerys['val'][$v['fieldid']]['preg'] : ($v['validate'] ? $v['validate'] : $profilevalidate[$v['fieldid']])).'"/>',			'<a href="admin.php?action=members&operation=profile&fieldid='.$v['fieldid'].'">'.lang('plugin/onemary_register', 'edit').'</a>'));		}	}	showtagfooter('tbody');	showtablefooter();	showsubmit('submit', 'submit');	showformfooter();	shownav('extended', 'nav_ec', 'nav_ec_config');}?>