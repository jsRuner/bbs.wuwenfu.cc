var editorLoaded=false;(function($){$.extend({selectArea:function(obj,level){var vtype=$(obj).attr("vtype");var combineArea=function(){var area="";var count=0;$("select",$(obj).parents("span[package]")).each(function(i){if($(this).val()!=""){area+=$(this).find("option:selected").text()+":";count++}});var district=$("select:eq("+(count-1)+")",$(obj).parents("span[package]")).val();area+=district;$("input:first",$(obj).parents("span[package]")).val(area);var arr=area.split(":");if(arr.length==4&&$("#selected-area").length){var str="";if($.inArray(arr[0],["\u5317\u4eac","\u5929\u6d25","\u4e0a\u6d77","\u91cd\u5e86"])==-1){str=arr[0]+arr[1]+arr[2]}else{str=arr[1]+arr[2]}$("#selected-area").html(str);if($("#shipping").length){var url=typeof dummyUrl=="undefined"||dummyUrl===null?"":dummyUrl;url=url.replace("DUMMY_MODULE/DUMMY_ACTION","Sales/orderDeliveryList").replace("id/DUMMY_ID","").replace("/pid/DUMMY_PID","");var od=$("#c_order_detail").data("order_detail")?$("#c_order_detail").data("order_detail"):"";var data="area="+area;if(od!=""){data+="&"+od}$.page(url,{update:"#shipping",method:"post",data:data})}}};if(obj.value==""){$(obj).next().remove();combineArea()}else{if(level==4){combineArea()}else{if(vtype){level=level+"/vtype/"+vtype}var settings=CMaxMain.getSettings();var url=settings.dummyUrl.replace("DUMMY_MODULE/DUMMY_ACTION","Region/selectArea").replace("id/DUMMY_ID","level/"+level).replace("pid/DUMMY_PID","/pid/"+obj.value);$.get(url,function(data){$(obj).next().remove();$(obj).after(data);combineArea()})}}},arrayUnique:function(array){var ret=[],done={};try{for(var i=0,length=array.length;i<length;i++){var tmp=array[i];if(!done[tmp]){done[tmp]=true;ret.push(tmp)}}}catch(e){ret=array}return ret},fileClear:function(){var file=$(":file");file.after(file.clone().val(""));file.remove();Utils.loading()},unserialize:function(serializedString){var str=decodeURI(serializedString);var pairs=str.split("&");var obj={},p,idx,val;for(var i=0,n=pairs.length;i<n;i++){p=pairs[i].split("=");idx=p[0];if(idx.indexOf("[]")==(idx.length-2)){var ind=idx.substring(0,idx.length-2);if(obj[ind]===undefined){obj[ind]=[]}obj[ind].push(p[1])}else{obj[idx]=p[1]}}return obj},random:function(min,max){var rand=parseInt(Math.random()*(max-min+1)+min);return rand},msgBox:function(msg,opt){opt=$.extend({css:"success"},opt||{});$("<div>").appendTo(document.body).html("<h4>"+msg+"</h4>").addClass(opt.css).show().delay(2000).animate({left:"0",opacity:"0"},1000).hide("fast",function(){$(this).remove()})},selectAll:function(){$(".sellist").attr("checked",true);$("#finder-form").data("rowselectall","1");$('#finder-list input[type="checkbox"]').attr("checked",true);$("#finder-list input[type='checkbox']").parents("tr").addClass("selected");$("#finder-tip .selected").hide();$("#finder-tip .selectedall").show().css({display:"block"});$("#finder-tip").show()},unselectAll:function(){$(".sellist").attr("checked",false);$("#finder-form").removeData("rowselectall");$('#finder-list input[type="checkbox"]').attr("checked",false);$("#finder-list input[type='checkbox']").parents("tr").removeClass("selected");$("#finder-tip").hide();Utils.resize()},closeFinderDetail:function(s){if(s){$('tr[item-id="'+s+'"]').removeClass("open")}$(".ico_open_on").removeClass("ico_open_on");$(".finder-detail-content").html("");$("#finder-detail").width("auto");$("#finder-detail").height(0);Utils.resize()},getSerializeData:function(el){if(typeof el=="string"||el instanceof jQuery==false){el=$(el)}return(el.get(0)&&el.get(0).tagName.toUpperCase()=="FORM")?el.serialize():$("input,select,textarea,radio,checkbox",el).serialize()},getJsonData:function(el){if(typeof el=="string"||el instanceof jQuery==false){el=$(el)}return el.get(0).tagName.toUpperCase()=="FORM"?el.serializeArray():$("input,select,textarea,radio,checkbox",el).serializeArray()},send:function(url,opt){opt=$.extend({method:"get",data:null},opt||{});var hash,oldhash,settings=CMaxMain.getSettings();if(url&&url!=""){if(url.indexOf(settings.baseUrl+settings.app)!=-1){hash=url.replace(settings.baseUrl+settings.app,"")}else{hash=url.replace(settings.app,"")}oldHash=window.location.hash.substring(1);if(oldHash!=unescape(hash)){CMaxMain.setSettings({opt:opt});window.location.hash=hash;return true}}else{hash=window.location.hash.replace(/#/g,"");if(hash!=""){url=settings.app+hash}else{url=settings.dashboardUrl}var browser=Utils.getBrowser();if(browser.IE6){var str=window.location.href;var pos=str.indexOf("?");if(pos!=-1){url+=str.substr(pos)}}}if(url!=""&&url.indexOf("_sc=")==-1){var _sc="";$("#sidecontent div[id^='submenu_']").each(function(){_sc+=","+$(this).attr("id").replace(/^submenu_/,"")});if(_sc!=""){_sc=_sc.substring(1);if(url.indexOf("?")==-1){url+="?_sc="+_sc}else{url+="&_sc="+_sc}}}if(url!=""){$.page(url,opt)}},refresh:function(opt){opt=$.extend({url:null,form:"#finder-form",data:null,enforce:false},opt||{});if(!opt.url){if(opt.form&&opt.form!=""&&$(opt.form).length&&$(opt.form).attr("action")!=""){opt.url=$(opt.form).attr("action")}else{var hash=window.location.hash.replace(/^#/,""),_sc="";var settings=CMaxMain.getSettings();var url=settings.dashboardUrl;if(hash!=""){opt.url=settings.app+hash}}}if((opt.data&&typeof opt.data=="string"&&opt.data.indexOf("=")==-1)||(opt.data&&typeof opt.data!="string"&&opt.data instanceof jQuery==false)){opt.data=$.getSerializeData(opt.data)}else{if(opt.form){opt.data=$.getSerializeData(opt.form)}}if(opt.url!=""){if(opt.enforce){if(opt.url.indexOf("?")==-1){opt.url+="?enforce=1"}else{opt.url+="&enforce=1"}}$.page(opt.url,{method:"post",data:opt.data})}},uploadCallback:function(data){Utils.loading();if(data.status){$.msgBox(data.msg);if(data.url!=null&&data.url!=""){$.send(data.url)}}else{$.msgBox(data.msg,{css:"error"})}},page:function(u,opt){var settings=CMaxMain.getSettings();var browser=Utils.getBrowser();opt=$.extend({cache:true,method:"get",data:null,update:"#main",loading:"#loading,#mask",append:false,inpager:false,onBeforeSend:function(){$(opt.loading).show();if(typeof opt.onStart=="function"){opt.onStart()}},onSuccess:function(data){if(opt.update!=null){if(typeof(data)=="object"&&Object.prototype.toString.call(data).toLowerCase()=="[object object]"&&!data.length){if(data.status){$.msgBox(data.info.msg?data.info.msg:data.info)}else{$.msgBox(data.info,{css:"error"})}if(data.url){var option={};if((data.url.indexOf("_withcondition=1")!=-1||data.url.indexOf("_withcondition/1")!=-1)&&$("#savedcondition").length==1){data.url=$("#savedcondition").attr("action");if(data.url.indexOf("?")==-1){data.url+="?_withcondition=1"}else{data.url+="&_withcondition=1"}option.method="post";option.data=$.getSerializeData("#savedcondition")}$.send(data.url,option)}if(data.jumpToUrl){top.window.location.href=data.jumpToUrl}if(data.info.jumpToUrl){top.window.location.href=data.info.jumpToUrl}if(data.refresh){$.refresh({form:data.refresh})}if(data.script){eval(data.script)}}else{if(opt.method=="get"&&!opt.inpager){if($("#headBar")){$("#headBar").html("")}if($("#footBar")&&!settings.singlePage){$("#footBar").html("")}}if(opt.dataType=="json"){if(data.substr(0,1)=="{"&&data.substr(-1,1)=="}"){data=eval("("+data+")")}else{data={info:data}}if(data.status){$.msgBox(data.info.msg?data.info.msg:data.info)}else{if(data.info){$.msgBox(data.info,{css:"error"})}}if(data.info.jumpUrl){$.send(data.info.jumpUrl)}if(data.refresh){$.refresh({form:data.refresh})}if(data.url){$.send(data.url)}if(data.jumpToUrl){top.window.location.href=data.jumpToUrl}if(data.info.jumpToUrl){top.window.location.href=data.info.jumpToUrl}if(data.script){eval(data.script)}}else{if(opt.append){opt.update.append(data)}else{opt.update.html(data)}}}}else{if(data!=""){if(opt.evtobj){opt.evtobj.html(data)}else{try{if(data.status=="1"){$.msgBox(data.info.msg?data.info.msg:data.info)}else{if(data.status=="0"){$.msgBox(data.info,{css:"error"})}}if(data.refresh){$.refresh({form:data.refresh})}if(data.url){$.send(data.url)}if(data.jumpToUrl){top.window.location.href=data.jumpToUrl}if(data.info.jumpToUrl){top.window.location.href=data.info.jumpToUrl}if(data.script){eval(data.script)}}catch(err){}}}}},onComplete:function(data){$(opt.loading).hide();if(typeof opt.callback=="function"){opt.callback(data)}Utils.resize()},onStart:null,callback:null,onError:function(xhr,type){if(opt.update!=null){if(opt.dataType=="json"){$.msgBox(xhr.responseText,{css:"error"})}else{if(opt.append){opt.update.append(xhr.responseText)}else{opt.update.html(xhr.responseText)}}}else{$.msgBox(xhr.responseText,{css:"error"})}}},opt||{});if(opt.update!=null&&(typeof opt.update=="string"||opt.update instanceof jQuery==false)){opt.update=$(opt.update)}if((opt.data&&typeof opt.data=="string"&&opt.data.indexOf("=")==-1)||(opt.data&&typeof opt.data!="string"&&opt.data instanceof jQuery==false)){opt.data=$.getSerializeData(opt.data)}$.ajax({url:u,type:opt.method,cache:opt.cache,data:opt.data,beforeSend:opt.onBeforeSend,success:opt.onSuccess,error:opt.onError,complete:opt.onComplete})},openWin:function(b,a){a=$.extend({width:$(window).width()*0.8,height:$(window).height()*0.8},a||{});var c="toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width="+a.width+",height="+a.height;window.open(b||"about:blank","_blank",c)},dialog:function(u,opt){var d=new Date(),div="dialog-"+d.getTime(),win=null;opt=$.extend({cache:true,method:"get",data:null,update:"#"+div,loading:"#loading,#mask",append:false,inpager:false,modal:true,title:"dialog",width:300,height:"auto",margin:"",padding:"",resizable:false,onBeforeSend:function(){$(opt.loading).show();win=$('<div id="'+div+'">');if(opt.margin!=""){win.css("margin",opt.margin)}if(opt.padding!=""){win.css("padding",opt.padding)}win.appendTo(document.body);if(typeof opt.onStart=="function"){opt.onStart(opt)}},onSuccess:function(data){if(typeof(data)=="object"&&Object.prototype.toString.call(data).toLowerCase()=="[object object]"&&!data.length){if(data.status){$.msgBox(data.info.msg?data.info.msg:data.info)}else{$.msgBox(data.info,{css:"error"})}if(data.jumpToUrl){top.window.location.href=data.jumpToUrl}}else{win.html(data);win.dialog({title:opt.title,bgiframe:true,width:opt.width,height:opt.height,modal:opt.modal,resizable:opt.resizable,close:opt.onClose})}},onComplete:function(){$(opt.loading).hide();if(typeof opt.callback=="function"){opt.callback(opt)}},onStart:null,callback:null,callclose:null,onClose:function(){if(typeof opt.callclose=="function"){opt.callclose()}$(this).remove()},onError:function(){}},opt||{});if((opt.data&&typeof opt.data=="string"&&opt.data.indexOf("=")==-1)||(opt.data&&typeof opt.data!="string"&&opt.data instanceof jQuery==false)){opt.data=$.getSerializeData(opt.data)}$.ajax({url:u,type:opt.method,cache:opt.cache,data:opt.data,beforeSend:opt.onBeforeSend,success:opt.onSuccess,error:opt.onError,complete:opt.onComplete})},closeDialog:function(obj){if(obj){if(typeof obj=="string"||obj instanceof jQuery==false){obj=$(obj)}obj.parents('div[id^="dialog-"]').dialog("close")}else{$('div[id^="dialog-"]').dialog("close")}},showCaution:function(a,c){var b=a.next();if(b&&b.attr("name")&&b.attr("name")=="validationMsgBox"){return}if(!c||$.trim(c)==""){return}if(a.attr("vtype")=="area"){b=a.parent().next();if(b&&b.attr("name")&&b.attr("name")=="validationMsgBox"){return}if(!a.hasClass("warning")){a.addClass("warning")}$('<span class="warningtxt" name="validationMsgBox">'+c+"</span>").insertAfter(a.parent())}else{if(a.attr("vtype")=="requiredcheckbox"){b=a.parent().parent();if(b&&b.find('span[name="validationMsgBox"]').length){return}if(!a.hasClass("warning")){a.addClass("warning")}$('<span class="warningtxt" name="validationMsgBox">'+c+"</span>").appendTo(a.parent().parent())}else{if(!a.hasClass("warning")){a.addClass("warning")}$('<span class="warningtxt" name="validationMsgBox">'+c+"</span>").insertAfter(a)}}},removeCaution:function(a){var b=a.next();if(a.attr("vtype")=="area"){b=a.parent().next()}else{if(a.attr("vtype")=="requiredcheckbox"){b=a.parent().parent().find('span[name="validationMsgBox"]')}}if(b&&b.attr("name")&&b.attr("name")=="validationMsgBox"){if(a.hasClass("warning")){a.removeClass("warning")}return b.remove()}},initQuickSearch:function(obj,val){$("#finder-search").attr("current_key",obj.attr("field_name")).find("label").html(obj.html());$("#finder-search span:eq(1)").remove();if(typeof val=="undefined"){val=""}var valArr=val.split(",");var s0=valArr[0];var s1="";if(valArr.length>1){s1=valArr[1]}switch(obj.attr("field_type")){case"int":case"smallint":case"tinyint":$("#finder-search span:eq(0)").after('<span>\u5927\u4e8e<input type="text" class="searchtxt" style="margin-right:0;width:50px;" value="'+s0+'">\u5c0f\u4e8e<input type="text" class="searchtxt" style="width:50px;" value="'+s1+'"></span>');break;case"datetime":case"date":$("#finder-search span:eq(0)").after('<span>\u5927\u4e8e<input type="text" class="searchtxt" style="margin-right:0;width:70px;" value="'+s0+'">\u5c0f\u4e8e<span style="margin-right:18px"><input type="text" class="searchtxt" style="margin-right:0;width:70px;" value="'+s1+'"></span></span>');var settings=CMaxMain.getSettings();$('input[class^="searchtxt"]').datepicker({showOn:"button",buttonImage:settings.publicUrl+"/common/images/b_calendar.png",buttonImageOnly:true});break;case"enum":var field_option=obj.attr("field_option");var field_defval=obj.attr("field_defval");var str="";var optArr=field_option.split(",");for(var i=0;i<optArr.length;i++){var arr=optArr[i].split(":");var sel="";if(s0==""){if(field_defval!=""&&field_defval==arr[0]){sel=" selected"}}else{if(s0==arr[0]){sel=" selected"}}if(arr.length==2){str+='<option value="'+arr[0]+'"'+sel+">"+arr[1]+"</option>"}else{str+='<option value="'+arr[0]+'"'+sel+">"+arr[0]+"</option>"}}$("#finder-search span:eq(0)").after('<span><select class="searchtxt"><option value="">\u8bf7\u9009\u62e9</option>'+str+"</select></span>");break;default:$("#finder-search span:eq(0)").after('<span><input type="text" class="searchtxt" value="'+s0+'"></span>');break}},finder:function(opt){opt=$.extend({model:null,enforce:null},opt||{});var exist=$("#finder-form",$("#main")).length;if(opt.enforce=="1"){if($("#finder-header",$("#main")).length){$("#headBar #finder-header").remove();$("#finder-header").insertBefore($("#finder-tip"))}}else{if($("#finder-action,#finder-form,#finder-tip,#finder-header,.mainHead",$("#main")).length){$("#headBar").html("");$("#finder-action,#finder-form,#finder-tip,#finder-header,.mainHead").appendTo($("#headBar"))}}if($("#finder-footer,#finder-detail,#mainFoot",$("#main")).length){$("#footBar").html("");$("#finder-footer,#finder-detail,#mainFoot").appendTo($("#footBar"))}var f=$("#finder-form");var rsa=(typeof f.data("rowselectall")=="undefined"||f.data("rowselectall")=="")?"":f.data("rowselectall");if(rsa!=""){$("#finder-list input[type='checkbox']").attr("checked",true)}else{var rsd=(typeof f.data("rowselected")=="undefined"||f.data("rowselected")=="")?"":f.data("rowselected");if(rsd!=""){var pairs=[];if(rsd){pairs=rsd.split("&")}$("#finder-list input[type='checkbox']").each(function(i,el){if($.inArray("data_id%5B%5D="+$(el).val(),pairs)!=-1){$(this).attr("checked",true)}})}}$("#finder-header .order").removeClass("asc").removeClass("desc");$('#finder-header .order[key="'+$('input[name="orderBy"]').val()+'"]').addClass($('input[name="orderType"]').val());if($("#finder-search").length&&exist){$(".finder-filter .lnk").bind("click",function(){$(".finder-filter-item").remove();$(".finder-filter").hide();Utils.resize();$.refresh();return false});$("#finder-search").bind("submit",function(){var name=$(this).attr("current_key");var label=$("label",$(this)).html();var val="";if($(".searchtxt",$(this)).length>1){$(".searchtxt",$(this)).each(function(i,el){val+=","+$(el).val()});if(val!=""){val=val.substring(1)}}else{val=$(".searchtxt",$(this)).val()}var item=$("#finder-form li.ffitpl").clone().removeClass("ffitpl").addClass("finder-filter-item");$("span",item).html(label+"\u4e3a:<b>"+val+"&nbsp;</b>");$("input",item).attr("name",name).val(val);$("#finder-form li.ffitpl input").attr("name","dummyInput");$(".finder-filter-item").remove();item.appendTo(".finder-filter-info");$("#finder-form #finder-filter").show();Utils.resize();$.refresh();return false});$("#finder-keywords li").click(function(){$.initQuickSearch($(this))})}if($('input[name="orderBy"]').val()!=""&&$('input[name="orderType"]').val()!=""){$('#finder-list [key="'+$('input[name="orderBy"]').val()+'"]').addClass($('input[name="orderType"]').val())}}})})(jQuery);var Utils=(function(){var m=false,r;function g(){var s={iOS:false,iPhone:false,iPad:false,Android:false,IE6:false,IE7:false,IE8:false,Firefox:false,SupportHtml5:false,SupportFlash:false};var t=navigator.userAgent;if(t.indexOf("iPhone")>=0){s.iOS=true;s.iPhone=true}else{if(t.indexOf("iPad")>=0){s.iOS=true;s.iPad=true}else{if(t.indexOf("Android")>=0){s.Android=true}else{if(t.indexOf("MSIE 6.0")>=0){s.IE6=true}else{if(t.indexOf("MSIE 7.0")>=0){s.IE7=true}else{if(t.indexOf("MSIE 8.0")>=0){s.IE8=true}else{if(t.indexOf("Firefox")>=0){s.Firefox=true}}}}}}}if(q()>0){s.SupportFlash=true}s.SupportHtml5=a();return s}function h(s){if(m&&$.support.opacity){console.log(s)}}function o(s){$(window).on("resize",p)}function q(){if(window.ActiveXObject){var v=null;try{v=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(u){}if(v){version=v.GetVariable("$version").substring(4);version=version.split(",");version=parseFloat(version[0]+"."+version[1]);delete v;return version}}else{if(typeof navigator.plugins["Shockwave Flash"]!=="undefined"){var w=navigator.plugins["Shockwave Flash"].description.split(" ");var t;for(var s=0;s<w.length;++s){if(isNaN(parseInt(w[s]))){continue}t=w[s]}return t}}return 0}function a(){if(typeof(Worker)!=="undefined"){return true}else{return false}}function b(){return g()}function p(){var t=window.mainHeight=$(window).height()-$(".header").height()-$(".footer").height();var s=window.mainH=t-$("#headBar").height()-$("#footBar").height();$("#main").css({height:s});$(".sidebar").height(t)}function j(){if($("body").hasClass("closeLeft")){$("body").removeClass("closeLeft")}else{$("body").addClass("closeLeft")}p()}function i(w){var u=CMaxMain.getSettings();$("#sidecontent [id^='submenu_']").hide();var t=false;if($("#sidecontent #submenu_"+w).length==0){$("#submenu_"+w).appendTo($("#sidecontent")).show()}else{if(w=="meeting"){$("#sidecontent #submenu_"+w).remove();$("#submenu_"+w).appendTo($("#sidecontent")).show()}else{$("#submenu_"+w).show();t=true}}var v=0;if($("#sidecontent #submenu_"+w).length>0&&w!="ciaedit"){$("#submenu_"+w+" li").removeClass("current");var s=window.location.hash.substring(1).split("?");hash=s[0];if(hash!=""&&s.length<=3){$("#submenu_"+w+" [href*='/"+hash+"']").each(function(){var x=$(this).attr("href").replace(u.baseUrl+u.app,"").replace(u.app,"");if(hash==x){$(this).addClass("current")}v=parseInt($(this).parent().index()/2);return false})}}if(!t){$("div[id^='submenu_"+w+"']").accordion({heightStyle:"fill",active:v})}if($("#submenu_"+w).length==0){if(!$("body").hasClass("closeLeft")){$("body").addClass("closeLeft")}}else{if($("body").hasClass("closeLeft")){$("body").removeClass("closeLeft")}}$(".menu li").removeClass("current");$(".menu li[name='"+w+"']").addClass("current")}function e(u,v){var t=function(){var w="";$("span[package] select").each(function(x){if($(this).val()!=""){w+=$(this).find("option:selected").text()+":"}});if($("span[package] select:last").val()==""){w+=$("span[package] select").eq(-2).val()}else{w+=$("span[package] select:last").val()}$("span[package] input:first").val(w)};if(u.value==""){$(u).next().remove()}else{if(v==4){t()}else{var s=typeof dummyUrl=="undefined"||dummyUrl===null?"":dummyUrl;s=s.replace("DUMMY_MODULE/DUMMY_ACTION","Setting/SelectArea").replace("DUMMY_ID",v).replace("pid=DUMMY_PID","pid="+u.value);$.get(s,function(w){$(u).next().remove();$(u).after(w);t()})}}}function n(){var t=$("#finder-form");if(typeof t.data("rowselected")=="undefined"||t.data("rowselected")==""){t.data("rowselected",$("#finder-list input[type='checkbox']").serialize())}else{var v=t.data("rowselected");var s=[];if(v){s=v.split("&")}$("#finder-list input[type='checkbox']:gt(0)").each(function(w,x){s=$.grep(s,function(z,y){return(z!="data_id%5B%5D="+$(x).val())});if(x.checked){s.push("data_id%5B%5D="+$(x).val())}});t.data("rowselected",s.join("&"))}var u=t.data("rowselected").split("&");$("#finder-tip").hide();if(u.length>1){$("#finder-tip .selected em").html(u.length);$("#finder-tip .selectedall").hide();$("#finder-tip .selected").show();$("#finder-tip").show()}p()}function l(t){var u="";$(t).each(function(){if(this.checked){u+=","+$(this).val()}});if(typeof u!="undefined"&&u!=""){u=u.substr(1)}else{u=""}return u}function f(t,s){t.attr("order",s);$(".orderable").removeClass("highlight-down").removeClass("highlight-up").removeClass("borderdown");t.addClass("borderdown");s=="asc"?t.addClass("highlight-up"):t.addClass("highlight-down")}function d(s){$(s).animate({marginTop:"-18px"},500,function(){$(this).css({marginTop:"0px"}).find("li:first").appendTo(this)})}function k(t,s){$(t).parents("li").remove();if(!$(".finder-filter-item").length){$(".finder-filter").hide()}p();$("#finder-form").attr("action",s);$.refresh()}function c(s){if(typeof s=="undefined"||!s){$("#loading,#mask").hide()}else{$("#loading,#mask").show()}}return{init:o,log:h,getBrowser:b,getFlashVersion:q,checkhHtml5:a,sideRender:i,finderTip:n,resize:p,autoScroll:d,leftToggler:j,loading:c}})();var CMaxMain=(function(){var settings={};function init(opt){settings=$.extend({singlePage:false},opt||{});Utils.init(false);var main=document.body;$(main).click(function(evt){if(!$(evt.target).parent().children("input").length&&!$(evt.target).hasClass("button")){$(".drop_menu").css({visibility:"hidden"})}$(".success,.error,.notice").css({visibility:"hidden"})});$(window).resize();$(window).hashchange(function(){var opt={};if(settings.opt){opt=settings.opt}$.send("",opt)});$(window).hashchange();$(main).delegate("[href]","click",function(){var obj=$(this);var url=obj.attr("href");if(url==""){obj=obj.parents("[href]");url=obj.attr("href")}if(url.substr(0,1)=="#"){return false}if(url.substr(0,11).toUpperCase()=="JAVASCRIPT:"){eval(url.substr(11));return false}if(obj.attr("confirm")){var f=$("#finder-form");if(typeof f.data("rowselected")=="undefined"||f.data("rowselected")==""){$.msgBox("\u8bf7\u9009\u62e9\u8981\u64cd\u4f5c\u7684\u6570\u636e\u9879\u3002",{css:"error"})}else{var msg=obj.attr("confirm");if(msg==""){msg="\u786e\u5b9a\u64cd\u4f5c\u9009\u4e2d\u9879\uff1f"}if(confirm(msg)){if(obj.hasClass("savecondition")){$("#savedcondition").remove();$("#finder-form").clone().attr("id","savedcondition").hide().appendTo(document.body);$("#savedcondition").attr("action",window.location.hash.replace(/^#/,"/"));$("#savedcondition").attr("field_type",$("#finder-search").attr("field_type"));$("#savedcondition").attr("current_key",$("#finder-search").attr("current_key"));var val="";if($("#finder-search .searchtxt").length>1){$("#finder-search .searchtxt").each(function(i,el){val+=","+$(el).val()});if(val!=""){val=val.substring(1)}}else{val=$("#finder-search .searchtxt").val()}$("#savedcondition").attr("searchtxt",val)}var data=f.data("rowselected");var rsa=(typeof f.data("rowselectall")=="undefined"||f.data("rowselectall")=="")?"":f.data("rowselectall");data+="&rowselectall="+rsa;$.page(url,{method:"post",data:data,dataType:"json",callback:function(){f.removeData("rowselected");f.removeData("rowselectall");$(".sellist").attr("checked",false);$("#finder-tip").hide()}})}}return false}else{var opt=eval("("+obj.attr("opt")+")")||{};if(obj.parents(".page_num").length){opt.method="post";opt.data="#finder-form"}var t=obj.attr("target")?obj.attr("target").toUpperCase():"";switch(t){case"_CIA":$.openWin(url);return false;break;case"_SELF":case"_PARENT":case"_TOP":top.location.href=url;return false;break;case"_BLANK":break;default:if(obj.hasClass("savecondition")){$("#savedcondition").remove();$("#finder-form").clone().attr("id","savedcondition").hide().appendTo(document.body);$("#savedcondition").attr("field_type",$("#finder-search").attr("field_type"));$("#savedcondition").attr("current_key",$("#finder-search").attr("current_key"));var val="";if($("#finder-search .searchtxt").length>1){$("#finder-search .searchtxt").each(function(i,el){val+=","+$(el).val()});if(val!=""){val=val.substring(1)}}else{val=$("#finder-search .searchtxt").val()}$("#savedcondition").attr("searchtxt",val)}else{if(obj.hasClass("usecondition")){if($("#savedcondition").length==1){opt.method="post";opt.data=$.getSerializeData("#savedcondition");if(url.indexOf("_withcondition=1")==-1){if(url.indexOf("?")==-1){url+="?_withcondition=1"}else{url+="&_withcondition=1"}}}}else{if(obj.parents(".sidebar").length==1){if(!obj.parent().hasClass("current")){obj.parent().addClass("current").siblings().removeClass("current")}}}}$.send(url,opt);return false;break}}});$(main).delegate("form","submit",function(){if(typeof $(this).attr("data-bind")!="undefined"&&$(this).attr("data-bind")=="false"){return true}if(!$(this).validator()){Utils.loading();return false}var url=$(this).attr("action"),opt={};if(url==""){url=settings.app+window.location.hash.replace(/^#/,"")}if($(this).attr("target")){$(this).attr("action",url);this.submit()}else{var fileEl=$('input[type="file"]',$(this));var needUpload=false;if(fileEl.length>0){fileEl.each(function(i,el){if($.trim($(el).val())!=""){needUpload=true}});if(needUpload){Utils.loading(true);$(this).attr("enctype","multipart/form-data").attr("encoding","multipart/form-data");if(!$("#upload_iframe").length){$("<iframe>").attr("id","upload_iframe").attr("name","upload_iframe").hide().appendTo(document.body)}if(url.indexOf("?")==-1){url+="?_upload=true"}else{url+="&_upload=true"}$(this).attr("action",url).attr("target","upload_iframe");this.submit();$(this).removeAttr("enctype").removeAttr("encoding").removeAttr("target")}}if(!needUpload){opt.data=this;opt.method="post";opt.dataType=$(this).attr("datatype")||"json";if($(this).attr("opt")){opt=$.extend(opt,eval("("+$(this).attr("opt")+")"))}$.page(url,opt)}}return false});$(main).delegate("[dropmenu]","click",function(e){$(".drop_menu").css({visibility:"hidden"});var menuid=$(this).attr("dropmenu");var opt=$.extend({my:"left top",at:"left bottom",of:$(this),offset:null},eval("("+$(this).attr("opt")+")")||{});if(window.mainH<$("#"+menuid).height()){$("#"+menuid+" ul").height(window.mainH)}$("#"+menuid).position({my:opt.my,at:opt.at,of:opt.of,offset:opt.offset}).css({visibility:"visible"});e.stopPropagation()});$(".ui-dialog").delegate("#dlg_cancel","click",function(){$.closeDialog(this)});$("#main").delegate(".order","click",function(){var order=$(this).hasClass("asc")?"desc":"asc";$('input[name="orderBy"]').val($(this).attr("key"));$('input[name="orderType"]').val(order);$.refresh();$("#finder-header .order").removeClass("asc").removeClass("desc");$(this).addClass(order);return false});$("#main").delegate(".sellist","change",function(){$(this).attr("checked")=="checked"?$("#finder-list input[type='checkbox']").attr("checked",true).parents("tr").addClass("selected"):$("#finder-list input[type='checkbox']").attr("checked",false).parents("tr").removeClass("selected");Utils.finderTip()});$("#headBar").delegate(".resize","click",function(e){e.stopPropagation()});$("#main").delegate('input[type="checkbox"]',"change",function(){if(this.checked){$(this).parents("tr").addClass("selected");var flag=true;$("#finder-list tr:gt(0) input[type='checkbox']").each(function(){if(!this.checked){flag=false;return false}});if(flag){$(".sellist").attr("checked",true)}}else{$(this).parents("tr").removeClass("selected");$(".sellist").attr("checked",false);if($("#finder-form").data("rowselectall")=="1"){$("#finder-form").removeData("rowselectall")}}Utils.finderTip()});$("#main").delegate(".ico_open","click",function(){var tr=$(this).parents("tr");if(tr.hasClass("view-detail")){tr.removeClass("view-detail");$(this).removeClass("ico_open_on");$.closeFinderDetail()}else{$(this).addClass("ico_open_on");tr.addClass("view-detail").siblings().removeClass("view-detail");$.page($(this).attr("detail"),{update:".finder-detail-content",inpager:true,callback:function(){if($("#finder-detail").height()==0){$("#finder-detail").height(window.mainH/2);Utils.resize()}}})}});$("#footBar").delegate("#finder-pagesel li","click",function(e){$("input[name='listRows']").val($("input",$(this)).val());$.refresh()});$("#main").delegate("td.editable","click",function(e){$(".editable").removeClass("edit");$(this).addClass("edit")});$("#main").delegate("td.editable","dblclick",function(e){$(".editable").removeClass("edit");var that=$(this);$(this).addClass("edit");var url=typeof settings.dummyUrl=="undefined"||settings.dummyUrl===null?"":settings.dummyUrl;url=url.replace("DUMMY_MODULE/DUMMY_ACTION","Setting/cellEdit").replace("/id/DUMMY_ID/pid/DUMMY_PID","");var opt={method:"post",update:"#finder-list-col-editpanel",data:"id="+$(this).parents("tr").attr("item-id")+"&key="+$(this).attr("key")+"&entity_type_id="+$("#finder-header").attr("entity_type_id")+"&model="+$("#finder-header").attr("model"),callstart:function(){that.addClass("edit-begin")},callback:function(){that.addClass("edit-ing");$("#finder-list-col-editpanel").position({my:"left top",at:"center center",of:that}).css({visibility:"visible"});$('.cell-edit-action span[type="submit"]').bind("click",function(){opt.update=null;var data_text="";if($(".cell-edit-action select").length){data_text=$(".cell-edit-action select option:selected").text()}else{if($('.cell-edit-action input[type="radio"]').length){data_text=$('.cell-edit-action input[type="radio"]:checked').parent().text()}}opt.data=opt.data+"&"+$.getSerializeData(".cell-edit-action")+"&data_text="+data_text;opt.evtobj=$(".cell",that);opt.callstart=null;opt.callback=function(){that.removeClass("edit-ing").removeClass("edit-begin").removeClass("edit");$("#finder-list-col-editpanel").html("").css({visibility:"hidden"})};$.page($(this).parents(".cell-edit-action").attr("action"),opt)});$('.cell-edit-action span[type="button"]').bind("click",function(){$("#finder-list-col-editpanel").html("").css({visibility:"hidden"})})}};$.page(url,opt)});$("#headBar").delegate("#finder-form li img","click",function(e){$(this).parents("li").remove();if(!$("#finder-form .finder-filter-item").length){$("#finder-form .finder-filter").hide()}Utils.resize();$.refresh();return false})}function getSettings(){return settings}function setSettings(opt){settings=$.extend(settings,opt||{})}return{init:init,getSettings:getSettings,setSettings:setSettings}})();
