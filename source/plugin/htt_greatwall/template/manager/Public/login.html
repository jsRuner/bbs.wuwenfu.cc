<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>{$system_name}</title>
<link href="../Public/css/style.css" rel="stylesheet" type="text/css" media="all"/>
<script type="text/javascript" src="../Public/js/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="../Public/js/jquery-migrate-1.2.1.min.js"></script>
</head>

<body>
<div class="loginWrapper">
  <div class="loginBox">
    <div class="loginAlertBox">
      <h2>{$system_name} 管理系统</h2>
      <div class="errBox">
        <p><img src="../Public/images/erricon1.gif" width="16" height="16" /><span class="errorMsg"></span></p>
      </div>
    </div>
    <fieldset class="loginCont">
    <form method="post" action="{:U('Public/checkLogin')}" id="login-form">
    <input name="referer" type="hidden" value="{:I('get.referer')}" />
      <div>
        <label class="userIcon">用户名</label>
        <input type="text" class="loginInt" name="usrname" maxlength="50" autocomplete="off" placeholder="请输入用户名" value="{:cookie("username")}" />
      </div>
      <div>
        <label class="pwIcon">密码</label>
        <input type="password" class="loginInt" name="passwd" value="888888" maxlength="20" onfocus="if(this.value=='+_-_-_+') this.value='';return true;" onblur="if(this.value=='') this.value='+_-_-_+';return true;" />
      </div>
      <if condition="$verifycode_switch eq '1'">	
      <div>
        <label class="keyIcon">验证码</label>
        <input type="text" class="loginInt2" autocomplete="off" maxlength="5" name="verifycode" id="verifycode" value="请输入验证码" onfocus="if(this.value=='请输入验证码') this.value=''; return true;" onblur="if(this.value=='') this.value='请输入验证码';return true;">
        <ins class="code"><img src="{:U('Public/verify')}?{:time()}" class="verifycodeimg" alt="看不清楚，点击刷新验证码" title="看不清楚，点击刷新验证码" style="cursor:pointer"></ins> 
      </div>
      </if>
      <div>
        <label class="checkUser">
          <input type="checkbox" name="save_login_name" value="1" checked="checked" />
          记住用户名</label>
        <input type="submit" class="blueSmallBtn" value="登 录" />
      </div>
      </form>
    </fieldset>
  </div>
</div>
<script>
$(function(){
	$('.verifycodeimg').bind('click', function(){
    	var timestamp = new Date().getTime();
		$(this).attr('src', '{:U('Public/verify')}?'+timestamp);
    });
	//提交登录表单
	$("form").bind('submit', function(){
		$.ajax({
				url: '{:U('Public/checkLogin')}',
				type:'post',
				data:$(this).serialize(),
				success: function(data){
					if (data.status == '1')
					{
						window.location.href=data.url;
					}
					else
					{
						$('.errorMsg').html(data.info).parents('.errBox').show();
						$('.verifycodeimg').click();
					}
				}
			});
		return false;
	});
})
</script>
</body>
</html>
